<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>koa-restful | 王家辉</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?b0aae218897fa9d8a9f76e9a77e0b3c6";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
        </script>
    <meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.4db83471.css" as="style"><link rel="preload" href="/assets/js/app.993279b7.js" as="script"><link rel="preload" href="/assets/js/6.84b65277.js" as="script"><link rel="preload" href="/assets/js/1.aea8f69d.js" as="script"><link rel="preload" href="/assets/js/20.7851bf69.js" as="script"><link rel="prefetch" href="/assets/js/10.773750d6.js"><link rel="prefetch" href="/assets/js/11.9c550c64.js"><link rel="prefetch" href="/assets/js/12.1c4bb52d.js"><link rel="prefetch" href="/assets/js/13.6e0d3945.js"><link rel="prefetch" href="/assets/js/14.92cdc94d.js"><link rel="prefetch" href="/assets/js/15.ceb2aad6.js"><link rel="prefetch" href="/assets/js/16.98e457dd.js"><link rel="prefetch" href="/assets/js/17.7b1c135e.js"><link rel="prefetch" href="/assets/js/18.c5868c8b.js"><link rel="prefetch" href="/assets/js/19.82deba82.js"><link rel="prefetch" href="/assets/js/21.9c78d1df.js"><link rel="prefetch" href="/assets/js/22.9128234a.js"><link rel="prefetch" href="/assets/js/23.ddc70fb9.js"><link rel="prefetch" href="/assets/js/24.53492eb1.js"><link rel="prefetch" href="/assets/js/25.e621c55e.js"><link rel="prefetch" href="/assets/js/26.1a0b5c12.js"><link rel="prefetch" href="/assets/js/27.9f69b8d6.js"><link rel="prefetch" href="/assets/js/28.93f0cfcb.js"><link rel="prefetch" href="/assets/js/29.0a3f7c7e.js"><link rel="prefetch" href="/assets/js/3.e544a7db.js"><link rel="prefetch" href="/assets/js/30.4f75510b.js"><link rel="prefetch" href="/assets/js/31.c051244a.js"><link rel="prefetch" href="/assets/js/32.58502d28.js"><link rel="prefetch" href="/assets/js/33.8f833c46.js"><link rel="prefetch" href="/assets/js/34.90a54a7c.js"><link rel="prefetch" href="/assets/js/35.ed5eeeaa.js"><link rel="prefetch" href="/assets/js/36.c390d7e5.js"><link rel="prefetch" href="/assets/js/37.f536a426.js"><link rel="prefetch" href="/assets/js/38.89cc277a.js"><link rel="prefetch" href="/assets/js/39.18dcb6b9.js"><link rel="prefetch" href="/assets/js/4.6bbebfc7.js"><link rel="prefetch" href="/assets/js/40.3c09cfb9.js"><link rel="prefetch" href="/assets/js/41.4646e3a9.js"><link rel="prefetch" href="/assets/js/42.b88cf974.js"><link rel="prefetch" href="/assets/js/43.9ff19677.js"><link rel="prefetch" href="/assets/js/44.71c446da.js"><link rel="prefetch" href="/assets/js/45.1179358c.js"><link rel="prefetch" href="/assets/js/46.f845a990.js"><link rel="prefetch" href="/assets/js/47.3d2e0ea2.js"><link rel="prefetch" href="/assets/js/48.c65ab8ed.js"><link rel="prefetch" href="/assets/js/49.2e72ecf2.js"><link rel="prefetch" href="/assets/js/5.88aabc9d.js"><link rel="prefetch" href="/assets/js/50.7cebea0b.js"><link rel="prefetch" href="/assets/js/51.41c3d7f4.js"><link rel="prefetch" href="/assets/js/52.e3f0534f.js"><link rel="prefetch" href="/assets/js/53.e0ec1f70.js"><link rel="prefetch" href="/assets/js/54.f57890a6.js"><link rel="prefetch" href="/assets/js/55.30518321.js"><link rel="prefetch" href="/assets/js/56.8eaab731.js"><link rel="prefetch" href="/assets/js/57.b22044c8.js"><link rel="prefetch" href="/assets/js/58.7d5361bd.js"><link rel="prefetch" href="/assets/js/7.6529641a.js"><link rel="prefetch" href="/assets/js/8.90bb2ede.js"><link rel="prefetch" href="/assets/js/9.f3fbcaea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4db83471.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-106e3130><div data-v-106e3130><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-106e3130 data-v-106e3130><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4d3be7b7 data-v-106e3130 data-v-106e3130><h3 class="title" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7>王家辉</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7><input type="password" value="" data-v-4d3be7b7> <span data-v-4d3be7b7>Konck! Knock!</span> <button data-v-4d3be7b7>OK</button></label> <div class="footer" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7><span data-v-4d3be7b7><i class="iconfont reco-theme" data-v-4d3be7b7></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4d3be7b7>vuePress-theme-reco</a></span> <span data-v-4d3be7b7><i class="iconfont reco-copyright" data-v-4d3be7b7></i> <a data-v-4d3be7b7><span data-v-4d3be7b7>王家辉</span>
            
          <span data-v-4d3be7b7>2020 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-106e3130><div data-v-106e3130><div id="smart" class="wrapper-page" style="background-image:url(https://pan.zealsay.com/mweb/blog/WechatIMG11.png);background-position-x:center;background-position-y:center;background-size:cover;background-repeat-x:no-repeat;background-repeat-y:no-repeat;" data-v-106e3130><header class="navbar" data-v-106e3130><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="王家辉" class="logo"> <span class="site-name">王家辉</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-68728e36><a class="click" data-v-68728e36><div class="onOff daySwitch" data-v-68728e36><div class="star star1" data-v-68728e36></div> <div class="star star2" data-v-68728e36></div> <div class="star star3" data-v-68728e36></div> <div class="star star4" data-v-68728e36></div> <div class="star star5" data-v-68728e36></div> <div class="star sky" data-v-68728e36></div> <div class="sunMoon" data-v-68728e36><div class="crater crater1" data-v-68728e36></div> <div class="crater crater2" data-v-68728e36></div> <div class="crater crater3" data-v-68728e36></div> <div class="cloud part1" data-v-68728e36></div> <div class="cloud part2" data-v-68728e36></div></div></div></a></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="iconfont undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/技术笔记/" class="nav-link"><i class="iconfont undefined"></i>
  技术笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-106e3130></div> <aside class="sidebar" data-v-106e3130><div class="personal-info-wrapper" data-v-d528efe2 data-v-106e3130><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-d528efe2> <h3 class="name" data-v-d528efe2>
    王家辉
  </h3> <div class="num" data-v-d528efe2><div data-v-d528efe2><h3 data-v-d528efe2>44</h3> <h6 data-v-d528efe2>文章</h6></div> <div data-v-d528efe2><h3 data-v-d528efe2>10</h3> <h6 data-v-d528efe2>标签</h6></div></div> <hr data-v-d528efe2></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="iconfont undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/技术笔记/" class="nav-link"><i class="iconfont undefined"></i>
  技术笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4d3be7b7 data-v-106e3130><h3 class="title" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7>koa-restful</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7><input type="password" value="" data-v-4d3be7b7> <span data-v-4d3be7b7>Konck! Knock!</span> <button data-v-4d3be7b7>OK</button></label> <div class="footer" style="display:none;" data-v-4d3be7b7 data-v-4d3be7b7><span data-v-4d3be7b7><i class="iconfont reco-theme" data-v-4d3be7b7></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4d3be7b7>vuePress-theme-reco</a></span> <span data-v-4d3be7b7><i class="iconfont reco-copyright" data-v-4d3be7b7></i> <a data-v-4d3be7b7><span data-v-4d3be7b7>王家辉</span>
            
          <span data-v-4d3be7b7>2020 - </span>
          2023
        </a></span></div></div></div> <div data-v-106e3130><main class="page"><div class="page-title" style="display:none;"><h1 class="title">koa-restful</h1> <div class="page-info" data-v-04a855f8><i class="iconfont reco-account" data-v-04a855f8><span data-v-04a855f8>王家辉</span></i> <i class="iconfont reco-date" data-v-04a855f8><span data-v-04a855f8>2022-05-06</span></i> <i class="iconfont reco-eye" data-v-04a855f8><span id="/blogs/docs/koa/koa.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-04a855f8><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-04a855f8><span class="tag-item" data-v-04a855f8>koa</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p class="custom-block-title">介绍</p> <p><a href="https://gitee.com/shunxuan/restful" target="_blank" rel="noopener noreferrer">Node.js开发仿知乎服务端 深入理解RESTfulAPI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br></p></div> <h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <blockquote><p>koa
<a href="https://koa.bootcss.com/" target="_blank" rel="noopener noreferrer">koa文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>koa2 进阶学习笔记
<a href="https://chenshenhai.com/koa2-note/note/start/quick" target="_blank" rel="noopener noreferrer">koa2 进阶学习笔记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>数据库
<a href="https://segmentfault.com/a/1190000021870763" target="_blank" rel="noopener noreferrer">在mongoDB官网申请500M免费线上数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>POSTMAN接口文档
<a href="https://documenter.getpostman.com/view/6488012/2s93m91Lqk#d3861af1-3a75-4a78-be5d-2400f88dd414" target="_blank" rel="noopener noreferrer">POSTMAN接口文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>线上接口地址
http://123.60.177.34:30/</p></blockquote> <blockquote><p>企业级框架
下次准备尝试使用<a href="https://www.eggjs.org/zh-CN" target="_blank" rel="noopener noreferrer">eggjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，听说是spring?springBoot?</p></blockquote> <p>附注：将·POSTMAN接口文档·域名端口替换即可，弄了半天才部署到线上，不懂服务端没得法</p> <h2 id="第1章-学习之前要告诉你的"><a href="#第1章-学习之前要告诉你的" class="header-anchor">#</a> 第1章 学习之前要告诉你的</h2> <blockquote><p>这一章只有一节，也只有一个目的，就是告诉你这门课程讲了什么，最终做出的效果，以及学习这门课程你需要先掌握哪些技术。</p></blockquote> <h3 id="_1-1-关于这门课程你想知道的都在这一节里面了"><a href="#_1-1-关于这门课程你想知道的都在这一节里面了" class="header-anchor">#</a> 1-1 关于这门课程你想知道的都在这一节里面了</h3> <ul><li>课程目标
<ul><li>理解RESTful API的6个限制和若干最佳实践</li> <li>掌握Koa2、Postman、 MongoDB、JWT等技术</li> <li>运用上述技术搭建仿知乎RESTful API</li> <li>掌握阿里云线上部署方法</li></ul></li> <li>功能技术分析
<ul><li>RESTful API理论</li> <li>Koa2</li> <li>Postman</li> <li>MongoDB</li> <li>JWT</li> <li>阿里云部署</li></ul></li> <li>前置知识
<ul><li>Node.js 基础</li> <li>ES6、ES7 基础</li></ul></li> <li>重难点分析
<ul><li>RESTful API理论</li> <li>JWT认证原理</li> <li>复杂的数据库关系（一对多、多对多等）</li></ul></li> <li>课程建议
<ul><li>理论部分做到自问自答</li> <li>实战部分做到举一反三</li> <li>不止于本课程，学习更多技术</li></ul></li></ul> <h2 id="第2章-跟着-github-认识-restful-api"><a href="#第2章-跟着-github-认识-restful-api" class="header-anchor">#</a> 第2章 跟着 GitHub 认识 RESTful API</h2> <blockquote><p>本章以全球最大的同性社交社区 GitHub 的 RESTful API 十几个最佳实践为例，让你掌握最完整的 RESTful API 理论</p></blockquote> <h3 id="_2-1-rest-是什么以及它的-6-个限制"><a href="#_2-1-rest-是什么以及它的-6-个限制" class="header-anchor">#</a> 2-1 REST 是什么以及它的 6 个限制</h3> <h4 id="rest是什么-万维网软件结构风格"><a href="#rest是什么-万维网软件结构风格" class="header-anchor">#</a> REST是什么：万维网软件结构风格</h4> <p>REST：<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer</p> <ul><li>Representational: 数据的表现形式(JSON、XM.....)</li> <li>State: 当前状态或者数据</li> <li>Transfer: 数据传输</li></ul> <h4 id="restful的6个限制"><a href="#restful的6个限制" class="header-anchor">#</a> RESTful的6个限制</h4> <ol><li>客户一服务器( Client一Server )
<ul><li>关注点分离</li> <li>服务端专注数据存储,提升了简单性</li> <li>前端专注用户界面,提升了可移植性</li></ul></li> <li>无状态( Stateless )
<ul><li>所有用户会话信息都保存在客户端</li> <li>每次请求必须包括所有信息,不能依赖上下文信息</li> <li>服务端不用保存会话信息,提升了简单性、可靠性、可见性</li></ul></li> <li>缓存( Cache )
<ul><li>所有服务端响应都要被标为可缓存或不可缓存</li> <li>减少前后端交互,提升了性能</li></ul></li> <li>统一接口( Uniform Interface )
<ul><li>接口设计尽可能统一通用,提升了简单性、可见性</li> <li>接口与实现解耦,使前后端可以独立开发迭代</li></ul></li> <li>分层系统( Layered System )
<ul><li>每层只知道相邻的一层,后面隐藏的就不知道了</li> <li>客户端不知道是和代理还是真实服务器通信</li> <li>其他层:安全层、负载均衡、缓存层等</li></ul></li> <li>按需代码( Code一On一Demand可选 )
<ul><li>客户端可以下载运行服务端传来的代码(比如JS)</li> <li>通过减少一些功能,简化了客户端</li></ul></li></ol> <h3 id="_2-2-统一接口的限制"><a href="#_2-2-统一接口的限制" class="header-anchor">#</a> 2-2 统一接口的限制</h3> <ul><li>资源的标识
<ul><li>资源是任何可以命名的事物,比如用户、评论等</li> <li>每个资源可以通过URI被唯一地标识
<ul><li>https://api.github.com/users</li> <li>https://api.github.com/users/lewis617</li></ul></li></ul></li> <li>通过表述来操作资源
<ul><li>表述就是Representation，比如JSON、XML等</li> <li>客户端不能直接操作(比如SQL)服务端资源</li> <li>客户端应该通过表述(比如JSON)来操作资源</li></ul></li> <li>自描述消息
<ul><li>每个消息（请求或响应）必须提供足够的信息让接受者理解</li> <li>媒体类型（application/json、application/xml）</li> <li>HTTP方法：GET（查）、POST（增）、DELETE（删）</li> <li>是否缓存： Cache-Control</li></ul></li> <li>超媒体作为应用状态引擎
<ul><li>超媒体：带文字的链接</li> <li>应用状态：一个网页</li> <li>引擎：驱动、跳转</li> <li>合起来：点击链接跳转到另一个网页</li></ul></li></ul> <h3 id="_2-3-restful-api-简介"><a href="#_2-3-restful-api-简介" class="header-anchor">#</a> 2-3 RESTful API 简介</h3> <h4 id="restful-api具体什么样子"><a href="#restful-api具体什么样子" class="header-anchor">#</a> RESTful API具体什么样子？</h4> <ul><li>基本的URI ，如https：//api.github.com/users</li> <li>标准HTTP方法，如GET， POST， PUT， PATCH， DELETE</li> <li>传输的数据媒体类型，如JSON， XML</li></ul> <h4 id="现实举例"><a href="#现实举例" class="header-anchor">#</a> 现实举例</h4> <table><thead><tr><th style="text-align:center;">Methed</th> <th style="text-align:center;">URI</th> <th style="text-align:center;">Meaning</th></tr></thead> <tbody><tr><td style="text-align:center;">GET</td> <td style="text-align:center;">/users</td> <td style="text-align:center;">获取user列表</td></tr> <tr><td style="text-align:center;">GET</td> <td style="text-align:center;">/users/1</td> <td style="text-align:center;">查看user1</td></tr> <tr><td style="text-align:center;">POST</td> <td style="text-align:center;">/users</td> <td style="text-align:center;">新建一个user</td></tr> <tr><td style="text-align:center;">PUT</td> <td style="text-align:center;">/users/1</td> <td style="text-align:center;">更新 user 1</td></tr> <tr><td style="text-align:center;">DELETE</td> <td style="text-align:center;">/users/1</td> <td style="text-align:center;">删除 user 1</td></tr></tbody></table> <h3 id="_2-4-restful-api-设计最佳实践"><a href="#_2-4-restful-api-设计最佳实践" class="header-anchor">#</a> 2-4 RESTful API 设计最佳实践</h3> <ul><li>请求设计规范
<ul><li>URI使用名词，尽量用复数，如/users</li> <li>URI使用嵌套表示关联关系，如/users/12/repos/5</li> <li>使用正确的HTTP方法，如GET/POST/PUT/DELETE</li> <li>不符合CRUD的情况：POST/action/子资源</li></ul></li> <li>相应设计规范
<ul><li>查询</li> <li>分页</li> <li>字段过滤</li> <li>状态码</li> <li>错误处理</li></ul></li> <li>安全
<ul><li>HTTPS</li> <li>鉴权</li> <li>限流</li></ul></li> <li>开发者友好
<ul><li>文档</li> <li>超媒体</li></ul></li></ul> <h2 id="第3章-用-koa-说-hello-world"><a href="#第3章-用-koa-说-hello-world" class="header-anchor">#</a> 第3章 用 Koa 说 Hello World</h2> <blockquote><p>本章将带你了解什么是 Koa 框架，搭建 Koa 框架的开发环境，并且编写第一个 Koa 框架的程序。不仅如此，重点是还要带你理解什么是 Koa 中间件以及经典的洋葱模型。</p></blockquote> <h3 id="_3-1-koa-简介"><a href="#_3-1-koa-简介" class="header-anchor">#</a> 3-1 Koa 简介</h3> <h4 id="一句话简介"><a href="#一句话简介" class="header-anchor">#</a> 一句话简介</h4> <blockquote><p>基于Node.js的下一代web开发<strong>框架</strong></p></blockquote> <ul><li>基于Node.js： Node.js模块</li> <li>下一代：蚕食第一代Web框架Express的市场</li> <li>Web框架：不是命令行工具、不是算法</li></ul> <h4 id="官网简介"><a href="#官网简介" class="header-anchor">#</a> 官网简介</h4> <blockquote><p>Koa是一个新的web框架，由Express幕后的原班人马打造，致力于成为web应用和API开发领域中的一个更小、更富有表现力、更健壮的基石。通过利用async函数， Koa帮你丢弃回调函数，并有力地增强错误处理。Koa并没有捆绑任何中间件，而是提供了一套优雅的方法，帮助您快速而愉快地编写服务端应用程序。</p></blockquote> <ul><li>由Express幕后的原班人马打造</li> <li>Web应用和API开发领域</li> <li>更小、更富有表现力、更健壮</li> <li>利用async函数，丢弃回调函数</li> <li>增强错误处理：try catch</li> <li>没有捆绑任何中间件</li> <li>快速而愉快地编写程序</li></ul> <h3 id="_3-2-安装搭建第一个-koa-程序"><a href="#_3-2-安装搭建第一个-koa-程序" class="header-anchor">#</a> 3-2 安装搭建第一个 Koa 程序</h3> <blockquote><p>操作步骤</p> <ul><li>初始化项目</li> <li>安装Koa</li> <li>编写Hello World</li> <li>学习自动重启</li></ul></blockquote> <h4 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h4> <p>在合适的位置新建项目文件夹</p> <p>在项目目录下执行<code>npm init</code></p> <h4 id="安装koa"><a href="#安装koa" class="header-anchor">#</a> 安装Koa</h4> <p><code>npm i koa --save</code></p> <p>新建JS文件，比如<code>index.js</code></p> <h4 id="编写hello-world"><a href="#编写hello-world" class="header-anchor">#</a> 编写Hello World</h4> <h4 id="自动重启"><a href="#自动重启" class="header-anchor">#</a> 自动重启</h4> <p><code>npm i nodemon --save-dev</code></p> <p>由于是本地安装所以并不能在项目文件夹下直接执行<code>nodemon index.js</code>，我们在<code>package.json</code>中添加如下命令：</p> <div class="language-json package.json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-3-koa-中间件与洋葱模型"><a href="#_3-3-koa-中间件与洋葱模型" class="header-anchor">#</a> 3-3 Koa 中间件与洋葱模型</h3> <blockquote><p>操作步骤</p> <ul><li>学习 async await</li> <li>学习编写Koa中间件</li> <li>学习洋葱模型</li></ul></blockquote> <h4 id="async-await"><a href="#async-await" class="header-anchor">#</a> async await</h4> <p>获取两个GitHub的接口并返回</p> <h4 id="编写koa中间件"><a href="#编写koa中间件" class="header-anchor">#</a> 编写Koa中间件</h4> <h4 id="洋葱模型"><a href="#洋葱模型" class="header-anchor">#</a> 洋葱模型</h4> <p>上节代码打印的顺序为：1 3 5 4 2，类似一个🧅</p> <h2 id="第4章-koa-框架的路由与-restful-api-最佳实践"><a href="#第4章-koa-框架的路由与-restful-api-最佳实践" class="header-anchor">#</a> 第4章 Koa 框架的路由与 RESTful API 最佳实践</h2> <blockquote><p>本章主要讲解 Koa 框架的路由。和其他课程的区别在于，不仅要学习 Koa 框架本身的路由用法，还要学习实现 REST 风格的路由用法。</p></blockquote> <h3 id="_4-1-路由简介"><a href="#_4-1-路由简介" class="header-anchor">#</a> 4-1 路由简介</h3> <h4 id="路由是什么"><a href="#路由是什么" class="header-anchor">#</a> 路由是什么？</h4> <ul><li>决定了不同URL是如何被不同地执行的</li> <li>在Koa中，是一个中间件</li></ul> <h4 id="为什么要用路由"><a href="#为什么要用路由" class="header-anchor">#</a> 为什么要用路由？</h4> <ul><li>如果没有路由，会怎么样？</li> <li>路由存在的意义</li></ul> <h4 id="如果没有路由"><a href="#如果没有路由" class="header-anchor">#</a> 如果没有路由</h4> <ul><li>所有请求都做了相同的事</li> <li>所有请求都会返回相同的结果</li></ul> <h4 id="路由存在的意义"><a href="#路由存在的意义" class="header-anchor">#</a> 路由存在的意义</h4> <ul><li>处理不同的URL</li> <li>处理不同的HTTP方法</li> <li>解析URL上的参数</li></ul> <h3 id="_4-2-自己编写-koa-路由中间件"><a href="#_4-2-自己编写-koa-路由中间件" class="header-anchor">#</a> 4-2 自己编写 Koa 路由中间件</h3> <blockquote><p>操作步骤</p> <ul><li>处理不同的URL</li> <li>处理不同的HTTP方法</li> <li>解析URL上的参数</li></ul></blockquote> <h3 id="_4-3-使用-koa-router-实现路由"><a href="#_4-3-使用-koa-router-实现路由" class="header-anchor">#</a> 4-3 使用 koa-router 实现路由</h3> <blockquote><p>操作步骤</p> <ul><li>更优雅地实现路由基本功能</li> <li>演示一些高级路由功能，如前缀、多中间件</li></ul></blockquote> <h4 id="路由基本功能"><a href="#路由基本功能" class="header-anchor">#</a> 路由基本功能</h4> <h4 id="高级路由功能"><a href="#高级路由功能" class="header-anchor">#</a> 高级路由功能</h4> <h3 id="_4-4-http-options-方法的作用是什么"><a href="#_4-4-http-options-方法的作用是什么" class="header-anchor">#</a> 4-4 HTTP options 方法的作用是什么</h3> <h4 id="为何要了解options方法的作用"><a href="#为何要了解options方法的作用" class="header-anchor">#</a> 为何要了解options方法的作用？</h4> <ul><li>这是一道面试题</li> <li>帮助理解koa-router的allowedMethods的作用</li></ul> <h4 id="http-options方法的作用是什么"><a href="#http-options方法的作用是什么" class="header-anchor">#</a> HTTP options方法的作用是什么？</h4> <ul><li>检测服务器所支持的请求方法</li> <li>CORS中的预检请求</li></ul> <h4 id="allowedmethods的作用"><a href="#allowedmethods的作用" class="header-anchor">#</a> allowedMethods的作用</h4> <ul><li>响应options方法，告诉它所支持的请求方法</li> <li>相应地返回405（不允许）和501（没实现）</li></ul> <h3 id="_4-5-restful-api-最佳实践-增删改查应该返回什么响应"><a href="#_4-5-restful-api-最佳实践-增删改查应该返回什么响应" class="header-anchor">#</a> 4-5 RESTful API 最佳实践——增删改查应该返回什么响应</h3> <blockquote><p>操作步骤</p> <ul><li>实现增删改查</li> <li>返回正确的响应</li></ul></blockquote> <h2 id="第5章-koa-框架的控制器以及设计更合理的目录结构"><a href="#第5章-koa-框架的控制器以及设计更合理的目录结构" class="header-anchor">#</a> 第5章 Koa 框架的控制器以及设计更合理的目录结构</h2> <blockquote><p>本章主要讲解 Koa 框架的控制器部分的内容。从如何获取 HTTP 的请求参数，到发送 HTTP 的响应，一应俱全。让你明白目录结构是怎么来设计的更合理。</p></blockquote> <h3 id="_5-1-控制器简介"><a href="#_5-1-控制器简介" class="header-anchor">#</a> 5-1 控制器简介</h3> <ul><li>什么是控制器？
<ul><li>拿到路由分配的任务，并执行</li> <li>在Koa中，是一个中间件</li></ul></li> <li>为什么要用控制器？
<ul><li>获取HTTP请求参数</li> <li>处理业务逻辑</li> <li>发送HTTP响应</li></ul></li> <li>获取HTTP请求参数
<ul><li>Query String, 如 <code>?q=keyword</code>, 一般为可选</li> <li>Router Params, 如 <code>/users/:id</code>, 一般为必选</li> <li>Body, 如 <code>{ name： &quot;李雷&quot; }</code></li> <li>Header, 如 <code>Accept</code>, <code>Cookie</code></li></ul></li> <li>发送HTTP响应
<ul><li>发送Status，如<code>200</code>/<code>400</code>等</li> <li>发送Body，如<code>{ name：&quot;李雷&quot; }</code></li> <li>发送Header，如<code>Allow</code>、<code>Content-Type</code></li></ul></li> <li>编写控制器最佳实践
<ul><li>每个资源的控制器放在不同的文件里</li> <li>尽量使用 类+类方法 的形式编写控制器</li> <li>严谨的错误处理</li></ul></li></ul> <h3 id="_5-2-获取-http-请求参数"><a href="#_5-2-获取-http-请求参数" class="header-anchor">#</a> 5-2 获取 HTTP 请求参数</h3> <blockquote><p>操作步骤</p> <ul><li>学习断点调试</li> <li>获取query (ctx.query)</li> <li>获取router params (ctx.params)</li> <li>获取body (ctx.request.body)</li> <li>获取header (ctx.header)</li></ul></blockquote> <h4 id="断点调试"><a href="#断点调试" class="header-anchor">#</a> 断点调试</h4> <p>VSCode中按F5进入调试并设置断点</p> <h4 id="获取body"><a href="#获取body" class="header-anchor">#</a> 获取body</h4> <p>koa不支持解析请求体，需要引入中间件<strong>koa-bodyparser</strong></p> <p><code>npm i koa-bodyparser --save</code></p> <h3 id="_5-3-发送-http-响应"><a href="#_5-3-发送-http-响应" class="header-anchor">#</a> 5-3 发送 HTTP 响应</h3> <blockquote><p>操作步骤</p> <ul><li>发送 status</li> <li>发送 body</li> <li>发送 header</li> <li>实现用户的增删改查</li></ul></blockquote> <h4 id="发送-status-body"><a href="#发送-status-body" class="header-anchor">#</a> 发送 status &amp; body</h4> <p><code>ctx.status = 204;</code></p> <p><code>ctx.body = '&lt;h1&gt;这是主页&lt;/h1&gt;';</code></p> <h4 id="发送-header"><a href="#发送-header" class="header-anchor">#</a> 发送 header</h4> <h4 id="实现用户的增删改查"><a href="#实现用户的增删改查" class="header-anchor">#</a> 实现用户的增删改查</h4> <h3 id="_5-4-更合理的目录结构"><a href="#_5-4-更合理的目录结构" class="header-anchor">#</a> 5-4 更合理的目录结构</h3> <blockquote><p>操作步骤</p> <ul><li>将路由单独放在一个目录</li> <li>将控制器单独放在一个目录</li> <li>使用 类+类方法 的方式组织控制器</li></ul></blockquote> <p>新建总文件夹<code>/app</code>，并修改入口文件</p> <div class="language-json package.json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>/app
<ul><li>/routes
<ul><li>home.js</li> <li>users.js</li></ul></li> <li>/controllers
<ul><li>home.js</li> <li>users.js</li></ul></li></ul></li></ul> <h2 id="第6章-多种方案实现错误处理机制"><a href="#第6章-多种方案实现错误处理机制" class="header-anchor">#</a> 第6章 多种方案实现错误处理机制</h2> <blockquote><p>本章主要讲解多种方案的错误处理。主要分三方面，一是 Koa 框架自带的错误处理，一是编写错误处理中间件，一是使用优秀的错误处理中间件。</p></blockquote> <h3 id="_6-1-错误处理简介"><a href="#_6-1-错误处理简介" class="header-anchor">#</a> 6-1 错误处理简介</h3> <ul><li>什么是错误处理？
<ul><li>编程语言或计算机硬件里的一种机制</li> <li>处理软件或信息系统中出现的异常状况</li></ul></li> <li>异常状况有哪些？
<ul><li>运行时错误，都返回500</li> <li>逻辑错误，如找不到（404）、先决条件失败（412）、无法处理的实体（参数格式不对，422）等</li></ul></li> <li>为什么要用错误处理？
<ul><li>防止程序挂掉</li> <li>告诉用户错误信息</li> <li>便于开发者调试</li></ul></li></ul> <h3 id="_6-2-koa-自带的错误处理"><a href="#_6-2-koa-自带的错误处理" class="header-anchor">#</a> 6-2 Koa 自带的错误处理</h3> <blockquote><p>操作步骤</p> <ul><li>制造404、412、500三种错误</li> <li>了解Koa自带的错误处理做了什么</li></ul></blockquote> <h3 id="_6-3-自己编写错误处理中间件"><a href="#_6-3-自己编写错误处理中间件" class="header-anchor">#</a> 6-3 自己编写错误处理中间件</h3> <blockquote><p>操作步骤</p> <ul><li>自己编写错误处理中间件</li> <li>制造404、412、500三种错误来测试</li></ul></blockquote> <h3 id="_6-4-使用-koa-json-error-进行错误处理"><a href="#_6-4-使用-koa-json-error-进行错误处理" class="header-anchor">#</a> 6-4 使用 koa-json-error 进行错误处理</h3> <blockquote><p>操作步骤</p> <ul><li>安装koa-json-error</li> <li>使用koa-json-error的默认配置处理错误</li> <li>修改配置使其在生产环境下禁用错误堆栈的返回</li></ul></blockquote> <p><code>npm i koa-json-error --save</code></p> <h3 id="_6-5-使用-koa-parameter-校验参数"><a href="#_6-5-使用-koa-parameter-校验参数" class="header-anchor">#</a> 6-5 使用 koa-parameter 校验参数</h3> <blockquote><p>操作步骤</p> <ul><li>安装koa一parameter</li> <li>使用koa一parameter校验参数</li> <li>制造422错误来测试校验结果</li></ul></blockquote> <p><code>npm i koa-parameter --save</code></p> <h2 id="第7章-第一批用户入库啦"><a href="#第7章-第一批用户入库啦" class="header-anchor">#</a> 第7章 第一批用户入库啦~~</h2> <blockquote><p>本章主要讲解 NoSQL 概念以及 MongoDB 数据库的理论与入门实践。通过 MongoDB Atlas 云数据库学习 MongoDB 的增删改查等常见操作。</p></blockquote> <h3 id="_7-1-nosql-简介"><a href="#_7-1-nosql-简介" class="header-anchor">#</a> 7-1 NoSQL 简介</h3> <ul><li>什么是NoSQL
<ul><li>对不同于传统的关系型数据库的数据库管理系统的统称</li></ul></li> <li>NoSQL数据库的分类
<ul><li>列存储（HBase）</li> <li>文档存储（MongoDB）</li> <li>Key-value存储（Redis）</li> <li>图存储（FlockDB）</li> <li>对象存储（db4o）</li> <li>XML存储（BaseX）</li></ul></li> <li>为什么要用NoSQL
<ul><li>简单（没有原子性、一致性、隔离性等复杂规范）</li> <li>便于横向拓展</li> <li>适合超大规模数据的存储</li> <li>很灵活地存储复杂结构的数据（Schema Free）</li></ul></li></ul> <h3 id="_7-2-mongodb-简介"><a href="#_7-2-mongodb-简介" class="header-anchor">#</a> 7-2 MongoDB 简介</h3> <ul><li>什么是MongoDB ？
<ul><li>来自于英文单词&quot;Humongous”， 中文含义为&quot;庞大”</li> <li>面向文档存储的开源数据库</li> <li>由C++编写而成</li></ul></li> <li>为什么要用MongoDB ？
<ul><li>性能好（内存计算）</li> <li>大规模数据存储（可拓展性）</li> <li>可靠安全（本地复制、自动故障转移）</li> <li>方便存储复杂数据结构（Schema Free）</li></ul></li></ul> <h3 id="_7-3-云数据库-mongodb-atlas"><a href="#_7-3-云数据库-mongodb-atlas" class="header-anchor">#</a> 7-3 云数据库——MongoDB Atlas</h3> <blockquote><p>操作步骤</p> <ul><li>注册用户</li> <li>创建集群</li> <li>添加数据库用户</li> <li>设置IP地址白名单</li> <li>获取连接地址</li></ul></blockquote> <p>如果连接mongodb过程中出现以下错误，可以尝试设置付款方式/检查用户名&amp;数据库名是否正确更改/等等再试</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Error: querySrv ESERVFAIL _mongodb._tcp.vincentebase.yqjup.mongodb.net
    at QueryReqWrap.onresolve <span class="token punctuation">[</span>as oncomplete<span class="token punctuation">]</span> <span class="token punctuation">(</span>dns.js:203:19<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  errno: <span class="token string">'ESERVFAIL'</span>,
  code: <span class="token string">'ESERVFAIL'</span>,
  syscall: <span class="token string">'querySrv'</span>,
  hostname: <span class="token string">'_mongodb._tcp.vincentebase.yqjup.mongodb.net'</span>
<span class="token punctuation">}</span>

Error: queryTxt ESERVFAIL vincentebase.yqjup.mongodb.net
    at QueryReqWrap.onresolve <span class="token punctuation">[</span>as oncomplete<span class="token punctuation">]</span> <span class="token punctuation">(</span>dns.js:203:19<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  errno: <span class="token string">'ESERVFAIL'</span>,
  code: <span class="token string">'ESERVFAIL'</span>,
  syscall: <span class="token string">'queryTxt'</span>,
  hostname: <span class="token string">'vincentebase.yqjup.mongodb.net'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><a href="https://stackoverflow.com/questions/50362647/connecting-to-mongodb-atlas-from-firebase-functions/58822693#58822693?newreg=a3af857c5c944c34a5f48ff365b97c0e" target="_blank" rel="noopener noreferrer">stackoverflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上的回答</p> <h3 id="_7-4-使用-mongoose-连接-mongodb"><a href="#_7-4-使用-mongoose-连接-mongodb" class="header-anchor">#</a> 7-4 使用 Mongoose 连接 MongoDB</h3> <blockquote><p>操作步骤</p> <ul><li>安装 Mong oose</li> <li>用 Mongoose 连接 MongoDB</li></ul></blockquote> <p><code>npm i mongoose --save</code></p> <h3 id="_7-5-设计用户模块的-schema"><a href="#_7-5-设计用户模块的-schema" class="header-anchor">#</a> 7-5 设计用户模块的 Schema</h3> <blockquote><p>操作步骤</p> <ul><li>分析用户模块的属性</li> <li>编写用户模块的Schema</li> <li>使用Schema生成用户Model</li></ul></blockquote> <h3 id="_7-6-用-mongodb-实现用户的增删改查"><a href="#_7-6-用-mongodb-实现用户的增删改查" class="header-anchor">#</a> 7-6 用 MongoDB 实现用户的增删改查</h3> <blockquote><p>操作步骤</p> <ul><li>用Mongoose实现增删改查接口</li> <li>用Postman测试增删改查接口</li></ul></blockquote> <h2 id="第8章-jwt-在-koa-框架中实现用户的认证与授权"><a href="#第8章-jwt-在-koa-框架中实现用户的认证与授权" class="header-anchor">#</a> 第8章 JWT 在 Koa 框架中实现用户的认证与授权</h2> <blockquote><p>本章主要讲解 JWT 如何实现用户的认证与授权。从 Session 开始讲解过渡到 JWT，关键在于 Session 和 JWT 的对比。以及通过 Koa 框架的 JWT 中间件实现用户注册于授权登录功能。</p></blockquote> <h3 id="_8-1-session-简介"><a href="#_8-1-session-简介" class="header-anchor">#</a> 8-1 Session 简介</h3> <ul><li>Session的优势
<ul><li>相比JWT，最大的优势就在于可以主动清除session了</li> <li>session保存在服务器端，相对较为安全</li> <li>结合cookie使用，较为灵活，兼容性较好</li></ul></li> <li>Session的劣势
<ul><li>cookie + session在跨域场景表现并不好</li> <li>如果是分布式部署，需要做多机共享session机制</li> <li>基于cookie的机制很容易被CSRF</li> <li>查询session信息可能会有数据库查询操作</li></ul></li> <li>Session相关的概念介绍
<ul><li>session: 主要存放在服务器端，相对安全</li> <li>cookie: 主要存放在客户端，并且不是很安全</li> <li>sessionStorage: 仅在当前会话下有效，关闭页面或浏览器后被清除</li> <li>localstorage: 除非被清除，否则永久保存</li></ul></li></ul> <h3 id="_8-2-jwt-简介"><a href="#_8-2-jwt-简介" class="header-anchor">#</a> 8-2 JWT 简介</h3> <h4 id="什么是jwt"><a href="#什么是jwt" class="header-anchor">#</a> 什么是JWT</h4> <ul><li>JSON Web Token是一个开放标准（RFC 7519）</li> <li>定义了一种紧凑且独立的方式，可以将各方之间的信息作为JSON对象进行安全传输</li> <li>该信息可以验证和信任，因为是经过数字签名的</li></ul> <h4 id="jwt的构成"><a href="#jwt的构成" class="header-anchor">#</a> JWT的构成</h4> <ul><li>头部（Header）
<ul><li>typ: token的类型， 这里固定为JWT</li> <li>alg: 使用的hash算法，例如：HMACSHA256或者RSA</li> <li>编码前: {&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}</li> <li>Base64编码: 'eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9'</li></ul></li> <li>有效载荷（Payload）
<ul><li>存储需要传递的信息，如用户ID、用户名等</li> <li>还包含元数据，如过期时间、发布人等</li> <li>与Header不同，Payload可以加密</li> <li>编码前: {&quot;user_id&quot;:&quot;zhangsan&quot;}</li> <li>Base64编码: 'eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQ=='</li> <li>Base64Url编码: 'eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQ'</li></ul></li> <li>签名（Signature）
<ul><li>对Header和Payload部分进行签名</li> <li>保证Token在传输的过程中没有被篡改或者损坏</li> <li>Signature = HMACSHA256(base64UrlEncode(header)+&quot;.&quot;+base64UrlEncode(payload), secret)</li></ul></li></ul> <h4 id="jwt工作原理"><a href="#jwt工作原理" class="header-anchor">#</a> JWT工作原理</h4> <image src="https://blog-1251959181.cos.ap-beijing.myqcloud.com/posts/354/JWT.png"></image> <h3 id="_8-3-jwt-vs-session"><a href="#_8-3-jwt-vs-session" class="header-anchor">#</a> 8-3 JWT vs. Session</h3> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">JWT</th> <th style="text-align:center;">Session</th></tr></thead> <tbody><tr><td style="text-align:center;">可拓展性</td> <td style="text-align:center;">无缝水平拓展</td> <td style="text-align:center;">适合垂直拓展</td></tr> <tr><td style="text-align:center;">安全性</td> <td style="text-align:center;">JS可修改JWT，签名+加密</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">RESTful API</td> <td style="text-align:center;">无状态</td> <td style="text-align:center;">有状态</td></tr> <tr><td style="text-align:center;">性能</td> <td style="text-align:center;">传输信息多，请求开销大</td> <td style="text-align:center;">需要查找用户信息，服务器开销大</td></tr> <tr><td style="text-align:center;">时效性</td> <td style="text-align:center;">只有到期才可销毁</td> <td style="text-align:center;">可以在服务器端更新</td></tr></tbody></table> <h3 id="_8-4-在-node-js-中使用-jwt"><a href="#_8-4-在-node-js-中使用-jwt" class="header-anchor">#</a> 8-4 在 Node.js 中使用 JWT</h3> <blockquote><p>操作步骤</p> <ul><li>安装 jsonwebtoken</li> <li>签名</li> <li>验证</li></ul></blockquote> <p><code>npm i jsonwebtoken</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>node
<span class="token operator">&gt;</span> jwt <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> token <span class="token operator">=</span> jwt.sign<span class="token punctuation">(</span><span class="token punctuation">{</span>name: <span class="token string">'vincente'</span><span class="token punctuation">}</span>, <span class="token string">'secret'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> jwt.decode<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> jwt.verify<span class="token punctuation">(</span>token, <span class="token string">'secret'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_8-5-实现用户注册"><a href="#_8-5-实现用户注册" class="header-anchor">#</a> 8-5 实现用户注册</h3> <blockquote><p>操作步骤</p> <ul><li>设计用户Schema</li> <li>编写保证唯一性的逻辑</li></ul></blockquote> <h3 id="_8-6-实现登录并获取-token"><a href="#_8-6-实现登录并获取-token" class="header-anchor">#</a> 8-6 实现登录并获取 Token</h3> <blockquote><p>操作步骤</p> <ul><li>登录接口设计</li> <li>用jsonwebtoken生成token</li></ul></blockquote> <h3 id="_8-7-自己编写-koa-中间件实现用户认证与授权"><a href="#_8-7-自己编写-koa-中间件实现用户认证与授权" class="header-anchor">#</a> 8-7 自己编写 Koa 中间件实现用户认证与授权</h3> <blockquote><p>操作步骤</p> <ul><li>认证：验证token ，并获取用户信息</li> <li>授权：使用中间件保护接口</li></ul></blockquote> <h3 id="_8-8-用-koa-jwt-中间件实现用户认证与授权"><a href="#_8-8-用-koa-jwt-中间件实现用户认证与授权" class="header-anchor">#</a> 8-8 用 koa-jwt 中间件实现用户认证与授权</h3> <blockquote><p>操作步骤</p> <ul><li>安装 koa-jwt</li> <li>使用中间件保护接口</li> <li>使用中间件获取用户信息</li></ul></blockquote> <p><code>npm i koa-jwt --save</code></p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      欢迎来到我的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="250" height="320" class="live2d" style="right:68px;bottom:10px;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://assets.smallsunnyfox.com/music/2.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://assets.smallsunnyfox.com/music/2.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://assets.smallsunnyfox.com/music/2.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>강남역 4번 출구</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Plastic / Fallin` Dild</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.993279b7.js" defer></script><script src="/assets/js/6.84b65277.js" defer></script><script src="/assets/js/1.aea8f69d.js" defer></script><script src="/assets/js/20.7851bf69.js" defer></script>
  </body>
</html>
