(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{513:function(t,a,_){"use strict";_.r(a);var s=_(2),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("介绍")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://gitee.com/shunxuan/restful",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js开发仿知乎服务端 深入理解RESTfulAPI"),_("OutboundLink")],1),_("br")])]),t._v(" "),_("h2",{attrs:{id:"写在前面"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#写在前面"}},[t._v("#")]),t._v(" 写在前面")]),t._v(" "),_("blockquote",[_("p",[t._v("koa\n"),_("a",{attrs:{href:"https://koa.bootcss.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("koa文档"),_("OutboundLink")],1)])]),t._v(" "),_("blockquote",[_("p",[t._v("koa2 进阶学习笔记\n"),_("a",{attrs:{href:"https://chenshenhai.com/koa2-note/note/start/quick",target:"_blank",rel:"noopener noreferrer"}},[t._v("koa2 进阶学习笔记"),_("OutboundLink")],1)])]),t._v(" "),_("blockquote",[_("p",[t._v("数据库\n"),_("a",{attrs:{href:"https://segmentfault.com/a/1190000021870763",target:"_blank",rel:"noopener noreferrer"}},[t._v("在mongoDB官网申请500M免费线上数据库"),_("OutboundLink")],1)])]),t._v(" "),_("blockquote",[_("p",[t._v("POSTMAN接口文档\n"),_("a",{attrs:{href:"https://documenter.getpostman.com/view/6488012/2s93m91Lqk#d3861af1-3a75-4a78-be5d-2400f88dd414",target:"_blank",rel:"noopener noreferrer"}},[t._v("POSTMAN接口文档"),_("OutboundLink")],1)])]),t._v(" "),_("blockquote",[_("p",[t._v("线上接口地址\nhttp://123.60.177.34:30/")])]),t._v(" "),_("blockquote",[_("p",[t._v("企业级框架\n下次准备尝试使用"),_("a",{attrs:{href:"https://www.eggjs.org/zh-CN",target:"_blank",rel:"noopener noreferrer"}},[t._v("eggjs"),_("OutboundLink")],1),t._v("，听说是spring?springBoot?")])]),t._v(" "),_("p",[t._v("附注：将·POSTMAN接口文档·域名端口替换即可，弄了半天才部署到线上，不懂服务端没得法")]),t._v(" "),_("h2",{attrs:{id:"第1章-学习之前要告诉你的"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第1章-学习之前要告诉你的"}},[t._v("#")]),t._v(" 第1章 学习之前要告诉你的")]),t._v(" "),_("blockquote",[_("p",[t._v("这一章只有一节，也只有一个目的，就是告诉你这门课程讲了什么，最终做出的效果，以及学习这门课程你需要先掌握哪些技术。")])]),t._v(" "),_("h3",{attrs:{id:"_1-1-关于这门课程你想知道的都在这一节里面了"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-关于这门课程你想知道的都在这一节里面了"}},[t._v("#")]),t._v(" 1-1 关于这门课程你想知道的都在这一节里面了")]),t._v(" "),_("ul",[_("li",[t._v("课程目标\n"),_("ul",[_("li",[t._v("理解RESTful API的6个限制和若干最佳实践")]),t._v(" "),_("li",[t._v("掌握Koa2、Postman、 MongoDB、JWT等技术")]),t._v(" "),_("li",[t._v("运用上述技术搭建仿知乎RESTful API")]),t._v(" "),_("li",[t._v("掌握阿里云线上部署方法")])])]),t._v(" "),_("li",[t._v("功能技术分析\n"),_("ul",[_("li",[t._v("RESTful API理论")]),t._v(" "),_("li",[t._v("Koa2")]),t._v(" "),_("li",[t._v("Postman")]),t._v(" "),_("li",[t._v("MongoDB")]),t._v(" "),_("li",[t._v("JWT")]),t._v(" "),_("li",[t._v("阿里云部署")])])]),t._v(" "),_("li",[t._v("前置知识\n"),_("ul",[_("li",[t._v("Node.js 基础")]),t._v(" "),_("li",[t._v("ES6、ES7 基础")])])]),t._v(" "),_("li",[t._v("重难点分析\n"),_("ul",[_("li",[t._v("RESTful API理论")]),t._v(" "),_("li",[t._v("JWT认证原理")]),t._v(" "),_("li",[t._v("复杂的数据库关系（一对多、多对多等）")])])]),t._v(" "),_("li",[t._v("课程建议\n"),_("ul",[_("li",[t._v("理论部分做到自问自答")]),t._v(" "),_("li",[t._v("实战部分做到举一反三")]),t._v(" "),_("li",[t._v("不止于本课程，学习更多技术")])])])]),t._v(" "),_("h2",{attrs:{id:"第2章-跟着-github-认识-restful-api"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第2章-跟着-github-认识-restful-api"}},[t._v("#")]),t._v(" 第2章 跟着 GitHub 认识 RESTful API")]),t._v(" "),_("blockquote",[_("p",[t._v("本章以全球最大的同性社交社区 GitHub 的 RESTful API 十几个最佳实践为例，让你掌握最完整的 RESTful API 理论")])]),t._v(" "),_("h3",{attrs:{id:"_2-1-rest-是什么以及它的-6-个限制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-rest-是什么以及它的-6-个限制"}},[t._v("#")]),t._v(" 2-1 REST 是什么以及它的 6 个限制")]),t._v(" "),_("h4",{attrs:{id:"rest是什么-万维网软件结构风格"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rest是什么-万维网软件结构风格"}},[t._v("#")]),t._v(" REST是什么：万维网软件结构风格")]),t._v(" "),_("p",[t._v("REST："),_("strong",[t._v("Re")]),t._v("presentational "),_("strong",[t._v("S")]),t._v("tate "),_("strong",[t._v("T")]),t._v("ransfer")]),t._v(" "),_("ul",[_("li",[t._v("Representational: 数据的表现形式(JSON、XM.....)")]),t._v(" "),_("li",[t._v("State: 当前状态或者数据")]),t._v(" "),_("li",[t._v("Transfer: 数据传输")])]),t._v(" "),_("h4",{attrs:{id:"restful的6个限制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#restful的6个限制"}},[t._v("#")]),t._v(" RESTful的6个限制")]),t._v(" "),_("ol",[_("li",[t._v("客户一服务器( Client一Server )\n"),_("ul",[_("li",[t._v("关注点分离")]),t._v(" "),_("li",[t._v("服务端专注数据存储,提升了简单性")]),t._v(" "),_("li",[t._v("前端专注用户界面,提升了可移植性")])])]),t._v(" "),_("li",[t._v("无状态( Stateless )\n"),_("ul",[_("li",[t._v("所有用户会话信息都保存在客户端")]),t._v(" "),_("li",[t._v("每次请求必须包括所有信息,不能依赖上下文信息")]),t._v(" "),_("li",[t._v("服务端不用保存会话信息,提升了简单性、可靠性、可见性")])])]),t._v(" "),_("li",[t._v("缓存( Cache )\n"),_("ul",[_("li",[t._v("所有服务端响应都要被标为可缓存或不可缓存")]),t._v(" "),_("li",[t._v("减少前后端交互,提升了性能")])])]),t._v(" "),_("li",[t._v("统一接口( Uniform Interface )\n"),_("ul",[_("li",[t._v("接口设计尽可能统一通用,提升了简单性、可见性")]),t._v(" "),_("li",[t._v("接口与实现解耦,使前后端可以独立开发迭代")])])]),t._v(" "),_("li",[t._v("分层系统( Layered System )\n"),_("ul",[_("li",[t._v("每层只知道相邻的一层,后面隐藏的就不知道了")]),t._v(" "),_("li",[t._v("客户端不知道是和代理还是真实服务器通信")]),t._v(" "),_("li",[t._v("其他层:安全层、负载均衡、缓存层等")])])]),t._v(" "),_("li",[t._v("按需代码( Code一On一Demand可选 )\n"),_("ul",[_("li",[t._v("客户端可以下载运行服务端传来的代码(比如JS)")]),t._v(" "),_("li",[t._v("通过减少一些功能,简化了客户端")])])])]),t._v(" "),_("h3",{attrs:{id:"_2-2-统一接口的限制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-统一接口的限制"}},[t._v("#")]),t._v(" 2-2 统一接口的限制")]),t._v(" "),_("ul",[_("li",[t._v("资源的标识\n"),_("ul",[_("li",[t._v("资源是任何可以命名的事物,比如用户、评论等")]),t._v(" "),_("li",[t._v("每个资源可以通过URI被唯一地标识\n"),_("ul",[_("li",[t._v("https://api.github.com/users")]),t._v(" "),_("li",[t._v("https://api.github.com/users/lewis617")])])])])]),t._v(" "),_("li",[t._v("通过表述来操作资源\n"),_("ul",[_("li",[t._v("表述就是Representation，比如JSON、XML等")]),t._v(" "),_("li",[t._v("客户端不能直接操作(比如SQL)服务端资源")]),t._v(" "),_("li",[t._v("客户端应该通过表述(比如JSON)来操作资源")])])]),t._v(" "),_("li",[t._v("自描述消息\n"),_("ul",[_("li",[t._v("每个消息（请求或响应）必须提供足够的信息让接受者理解")]),t._v(" "),_("li",[t._v("媒体类型（application/json、application/xml）")]),t._v(" "),_("li",[t._v("HTTP方法：GET（查）、POST（增）、DELETE（删）")]),t._v(" "),_("li",[t._v("是否缓存： Cache-Control")])])]),t._v(" "),_("li",[t._v("超媒体作为应用状态引擎\n"),_("ul",[_("li",[t._v("超媒体：带文字的链接")]),t._v(" "),_("li",[t._v("应用状态：一个网页")]),t._v(" "),_("li",[t._v("引擎：驱动、跳转")]),t._v(" "),_("li",[t._v("合起来：点击链接跳转到另一个网页")])])])]),t._v(" "),_("h3",{attrs:{id:"_2-3-restful-api-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-restful-api-简介"}},[t._v("#")]),t._v(" 2-3 RESTful API 简介")]),t._v(" "),_("h4",{attrs:{id:"restful-api具体什么样子"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#restful-api具体什么样子"}},[t._v("#")]),t._v(" RESTful API具体什么样子？")]),t._v(" "),_("ul",[_("li",[t._v("基本的URI ，如https：//api.github.com/users")]),t._v(" "),_("li",[t._v("标准HTTP方法，如GET， POST， PUT， PATCH， DELETE")]),t._v(" "),_("li",[t._v("传输的数据媒体类型，如JSON， XML")])]),t._v(" "),_("h4",{attrs:{id:"现实举例"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#现实举例"}},[t._v("#")]),t._v(" 现实举例")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",{staticStyle:{"text-align":"center"}},[t._v("Methed")]),t._v(" "),_("th",{staticStyle:{"text-align":"center"}},[t._v("URI")]),t._v(" "),_("th",{staticStyle:{"text-align":"center"}},[t._v("Meaning")])])]),t._v(" "),_("tbody",[_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("GET")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("/users")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("获取user列表")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("GET")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("/users/1")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("查看user1")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("POST")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("/users")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("新建一个user")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("PUT")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("/users/1")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("更新 user 1")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("DELETE")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("/users/1")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("删除 user 1")])])])]),t._v(" "),_("h3",{attrs:{id:"_2-4-restful-api-设计最佳实践"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-restful-api-设计最佳实践"}},[t._v("#")]),t._v(" 2-4 RESTful API 设计最佳实践")]),t._v(" "),_("ul",[_("li",[t._v("请求设计规范\n"),_("ul",[_("li",[t._v("URI使用名词，尽量用复数，如/users")]),t._v(" "),_("li",[t._v("URI使用嵌套表示关联关系，如/users/12/repos/5")]),t._v(" "),_("li",[t._v("使用正确的HTTP方法，如GET/POST/PUT/DELETE")]),t._v(" "),_("li",[t._v("不符合CRUD的情况：POST/action/子资源")])])]),t._v(" "),_("li",[t._v("相应设计规范\n"),_("ul",[_("li",[t._v("查询")]),t._v(" "),_("li",[t._v("分页")]),t._v(" "),_("li",[t._v("字段过滤")]),t._v(" "),_("li",[t._v("状态码")]),t._v(" "),_("li",[t._v("错误处理")])])]),t._v(" "),_("li",[t._v("安全\n"),_("ul",[_("li",[t._v("HTTPS")]),t._v(" "),_("li",[t._v("鉴权")]),t._v(" "),_("li",[t._v("限流")])])]),t._v(" "),_("li",[t._v("开发者友好\n"),_("ul",[_("li",[t._v("文档")]),t._v(" "),_("li",[t._v("超媒体")])])])]),t._v(" "),_("h2",{attrs:{id:"第3章-用-koa-说-hello-world"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第3章-用-koa-说-hello-world"}},[t._v("#")]),t._v(" 第3章 用 Koa 说 Hello World")]),t._v(" "),_("blockquote",[_("p",[t._v("本章将带你了解什么是 Koa 框架，搭建 Koa 框架的开发环境，并且编写第一个 Koa 框架的程序。不仅如此，重点是还要带你理解什么是 Koa 中间件以及经典的洋葱模型。")])]),t._v(" "),_("h3",{attrs:{id:"_3-1-koa-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-koa-简介"}},[t._v("#")]),t._v(" 3-1 Koa 简介")]),t._v(" "),_("h4",{attrs:{id:"一句话简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#一句话简介"}},[t._v("#")]),t._v(" 一句话简介")]),t._v(" "),_("blockquote",[_("p",[t._v("基于Node.js的下一代web开发"),_("strong",[t._v("框架")])])]),t._v(" "),_("ul",[_("li",[t._v("基于Node.js： Node.js模块")]),t._v(" "),_("li",[t._v("下一代：蚕食第一代Web框架Express的市场")]),t._v(" "),_("li",[t._v("Web框架：不是命令行工具、不是算法")])]),t._v(" "),_("h4",{attrs:{id:"官网简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#官网简介"}},[t._v("#")]),t._v(" 官网简介")]),t._v(" "),_("blockquote",[_("p",[t._v("Koa是一个新的web框架，由Express幕后的原班人马打造，致力于成为web应用和API开发领域中的一个更小、更富有表现力、更健壮的基石。通过利用async函数， Koa帮你丢弃回调函数，并有力地增强错误处理。Koa并没有捆绑任何中间件，而是提供了一套优雅的方法，帮助您快速而愉快地编写服务端应用程序。")])]),t._v(" "),_("ul",[_("li",[t._v("由Express幕后的原班人马打造")]),t._v(" "),_("li",[t._v("Web应用和API开发领域")]),t._v(" "),_("li",[t._v("更小、更富有表现力、更健壮")]),t._v(" "),_("li",[t._v("利用async函数，丢弃回调函数")]),t._v(" "),_("li",[t._v("增强错误处理：try catch")]),t._v(" "),_("li",[t._v("没有捆绑任何中间件")]),t._v(" "),_("li",[t._v("快速而愉快地编写程序")])]),t._v(" "),_("h3",{attrs:{id:"_3-2-安装搭建第一个-koa-程序"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-安装搭建第一个-koa-程序"}},[t._v("#")]),t._v(" 3-2 安装搭建第一个 Koa 程序")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("初始化项目")]),t._v(" "),_("li",[t._v("安装Koa")]),t._v(" "),_("li",[t._v("编写Hello World")]),t._v(" "),_("li",[t._v("学习自动重启")])])]),t._v(" "),_("h4",{attrs:{id:"初始化项目"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#初始化项目"}},[t._v("#")]),t._v(" 初始化项目")]),t._v(" "),_("p",[t._v("在合适的位置新建项目文件夹")]),t._v(" "),_("p",[t._v("在项目目录下执行"),_("code",[t._v("npm init")])]),t._v(" "),_("h4",{attrs:{id:"安装koa"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#安装koa"}},[t._v("#")]),t._v(" 安装Koa")]),t._v(" "),_("p",[_("code",[t._v("npm i koa --save")])]),t._v(" "),_("p",[t._v("新建JS文件，比如"),_("code",[t._v("index.js")])]),t._v(" "),_("h4",{attrs:{id:"编写hello-world"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写hello-world"}},[t._v("#")]),t._v(" 编写Hello World")]),t._v(" "),_("h4",{attrs:{id:"自动重启"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#自动重启"}},[t._v("#")]),t._v(" 自动重启")]),t._v(" "),_("p",[_("code",[t._v("npm i nodemon --save-dev")])]),t._v(" "),_("p",[t._v("由于是本地安装所以并不能在项目文件夹下直接执行"),_("code",[t._v("nodemon index.js")]),t._v("，我们在"),_("code",[t._v("package.json")]),t._v("中添加如下命令：")]),t._v(" "),_("div",{staticClass:"language-json package.json line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-json"}},[_("code",[_("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token property"}},[t._v('"start"')]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodemon index.js"')]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br"),_("span",{staticClass:"line-number"},[t._v("2")]),_("br"),_("span",{staticClass:"line-number"},[t._v("3")]),_("br")])]),_("h3",{attrs:{id:"_3-3-koa-中间件与洋葱模型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-koa-中间件与洋葱模型"}},[t._v("#")]),t._v(" 3-3 Koa 中间件与洋葱模型")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("学习 async await")]),t._v(" "),_("li",[t._v("学习编写Koa中间件")]),t._v(" "),_("li",[t._v("学习洋葱模型")])])]),t._v(" "),_("h4",{attrs:{id:"async-await"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#async-await"}},[t._v("#")]),t._v(" async await")]),t._v(" "),_("p",[t._v("获取两个GitHub的接口并返回")]),t._v(" "),_("h4",{attrs:{id:"编写koa中间件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#编写koa中间件"}},[t._v("#")]),t._v(" 编写Koa中间件")]),t._v(" "),_("h4",{attrs:{id:"洋葱模型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#洋葱模型"}},[t._v("#")]),t._v(" 洋葱模型")]),t._v(" "),_("p",[t._v("上节代码打印的顺序为：1 3 5 4 2，类似一个🧅")]),t._v(" "),_("h2",{attrs:{id:"第4章-koa-框架的路由与-restful-api-最佳实践"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第4章-koa-框架的路由与-restful-api-最佳实践"}},[t._v("#")]),t._v(" 第4章 Koa 框架的路由与 RESTful API 最佳实践")]),t._v(" "),_("blockquote",[_("p",[t._v("本章主要讲解 Koa 框架的路由。和其他课程的区别在于，不仅要学习 Koa 框架本身的路由用法，还要学习实现 REST 风格的路由用法。")])]),t._v(" "),_("h3",{attrs:{id:"_4-1-路由简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-路由简介"}},[t._v("#")]),t._v(" 4-1 路由简介")]),t._v(" "),_("h4",{attrs:{id:"路由是什么"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#路由是什么"}},[t._v("#")]),t._v(" 路由是什么？")]),t._v(" "),_("ul",[_("li",[t._v("决定了不同URL是如何被不同地执行的")]),t._v(" "),_("li",[t._v("在Koa中，是一个中间件")])]),t._v(" "),_("h4",{attrs:{id:"为什么要用路由"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用路由"}},[t._v("#")]),t._v(" 为什么要用路由？")]),t._v(" "),_("ul",[_("li",[t._v("如果没有路由，会怎么样？")]),t._v(" "),_("li",[t._v("路由存在的意义")])]),t._v(" "),_("h4",{attrs:{id:"如果没有路由"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#如果没有路由"}},[t._v("#")]),t._v(" 如果没有路由")]),t._v(" "),_("ul",[_("li",[t._v("所有请求都做了相同的事")]),t._v(" "),_("li",[t._v("所有请求都会返回相同的结果")])]),t._v(" "),_("h4",{attrs:{id:"路由存在的意义"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#路由存在的意义"}},[t._v("#")]),t._v(" 路由存在的意义")]),t._v(" "),_("ul",[_("li",[t._v("处理不同的URL")]),t._v(" "),_("li",[t._v("处理不同的HTTP方法")]),t._v(" "),_("li",[t._v("解析URL上的参数")])]),t._v(" "),_("h3",{attrs:{id:"_4-2-自己编写-koa-路由中间件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-自己编写-koa-路由中间件"}},[t._v("#")]),t._v(" 4-2 自己编写 Koa 路由中间件")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("处理不同的URL")]),t._v(" "),_("li",[t._v("处理不同的HTTP方法")]),t._v(" "),_("li",[t._v("解析URL上的参数")])])]),t._v(" "),_("h3",{attrs:{id:"_4-3-使用-koa-router-实现路由"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-使用-koa-router-实现路由"}},[t._v("#")]),t._v(" 4-3 使用 koa-router 实现路由")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("更优雅地实现路由基本功能")]),t._v(" "),_("li",[t._v("演示一些高级路由功能，如前缀、多中间件")])])]),t._v(" "),_("h4",{attrs:{id:"路由基本功能"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#路由基本功能"}},[t._v("#")]),t._v(" 路由基本功能")]),t._v(" "),_("h4",{attrs:{id:"高级路由功能"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#高级路由功能"}},[t._v("#")]),t._v(" 高级路由功能")]),t._v(" "),_("h3",{attrs:{id:"_4-4-http-options-方法的作用是什么"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-http-options-方法的作用是什么"}},[t._v("#")]),t._v(" 4-4 HTTP options 方法的作用是什么")]),t._v(" "),_("h4",{attrs:{id:"为何要了解options方法的作用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#为何要了解options方法的作用"}},[t._v("#")]),t._v(" 为何要了解options方法的作用？")]),t._v(" "),_("ul",[_("li",[t._v("这是一道面试题")]),t._v(" "),_("li",[t._v("帮助理解koa-router的allowedMethods的作用")])]),t._v(" "),_("h4",{attrs:{id:"http-options方法的作用是什么"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http-options方法的作用是什么"}},[t._v("#")]),t._v(" HTTP options方法的作用是什么？")]),t._v(" "),_("ul",[_("li",[t._v("检测服务器所支持的请求方法")]),t._v(" "),_("li",[t._v("CORS中的预检请求")])]),t._v(" "),_("h4",{attrs:{id:"allowedmethods的作用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#allowedmethods的作用"}},[t._v("#")]),t._v(" allowedMethods的作用")]),t._v(" "),_("ul",[_("li",[t._v("响应options方法，告诉它所支持的请求方法")]),t._v(" "),_("li",[t._v("相应地返回405（不允许）和501（没实现）")])]),t._v(" "),_("h3",{attrs:{id:"_4-5-restful-api-最佳实践-增删改查应该返回什么响应"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-restful-api-最佳实践-增删改查应该返回什么响应"}},[t._v("#")]),t._v(" 4-5 RESTful API 最佳实践——增删改查应该返回什么响应")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("实现增删改查")]),t._v(" "),_("li",[t._v("返回正确的响应")])])]),t._v(" "),_("h2",{attrs:{id:"第5章-koa-框架的控制器以及设计更合理的目录结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第5章-koa-框架的控制器以及设计更合理的目录结构"}},[t._v("#")]),t._v(" 第5章 Koa 框架的控制器以及设计更合理的目录结构")]),t._v(" "),_("blockquote",[_("p",[t._v("本章主要讲解 Koa 框架的控制器部分的内容。从如何获取 HTTP 的请求参数，到发送 HTTP 的响应，一应俱全。让你明白目录结构是怎么来设计的更合理。")])]),t._v(" "),_("h3",{attrs:{id:"_5-1-控制器简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-控制器简介"}},[t._v("#")]),t._v(" 5-1 控制器简介")]),t._v(" "),_("ul",[_("li",[t._v("什么是控制器？\n"),_("ul",[_("li",[t._v("拿到路由分配的任务，并执行")]),t._v(" "),_("li",[t._v("在Koa中，是一个中间件")])])]),t._v(" "),_("li",[t._v("为什么要用控制器？\n"),_("ul",[_("li",[t._v("获取HTTP请求参数")]),t._v(" "),_("li",[t._v("处理业务逻辑")]),t._v(" "),_("li",[t._v("发送HTTP响应")])])]),t._v(" "),_("li",[t._v("获取HTTP请求参数\n"),_("ul",[_("li",[t._v("Query String, 如 "),_("code",[t._v("?q=keyword")]),t._v(", 一般为可选")]),t._v(" "),_("li",[t._v("Router Params, 如 "),_("code",[t._v("/users/:id")]),t._v(", 一般为必选")]),t._v(" "),_("li",[t._v("Body, 如 "),_("code",[t._v('{ name： "李雷" }')])]),t._v(" "),_("li",[t._v("Header, 如 "),_("code",[t._v("Accept")]),t._v(", "),_("code",[t._v("Cookie")])])])]),t._v(" "),_("li",[t._v("发送HTTP响应\n"),_("ul",[_("li",[t._v("发送Status，如"),_("code",[t._v("200")]),t._v("/"),_("code",[t._v("400")]),t._v("等")]),t._v(" "),_("li",[t._v("发送Body，如"),_("code",[t._v('{ name："李雷" }')])]),t._v(" "),_("li",[t._v("发送Header，如"),_("code",[t._v("Allow")]),t._v("、"),_("code",[t._v("Content-Type")])])])]),t._v(" "),_("li",[t._v("编写控制器最佳实践\n"),_("ul",[_("li",[t._v("每个资源的控制器放在不同的文件里")]),t._v(" "),_("li",[t._v("尽量使用 类+类方法 的形式编写控制器")]),t._v(" "),_("li",[t._v("严谨的错误处理")])])])]),t._v(" "),_("h3",{attrs:{id:"_5-2-获取-http-请求参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-获取-http-请求参数"}},[t._v("#")]),t._v(" 5-2 获取 HTTP 请求参数")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("学习断点调试")]),t._v(" "),_("li",[t._v("获取query (ctx.query)")]),t._v(" "),_("li",[t._v("获取router params (ctx.params)")]),t._v(" "),_("li",[t._v("获取body (ctx.request.body)")]),t._v(" "),_("li",[t._v("获取header (ctx.header)")])])]),t._v(" "),_("h4",{attrs:{id:"断点调试"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#断点调试"}},[t._v("#")]),t._v(" 断点调试")]),t._v(" "),_("p",[t._v("VSCode中按F5进入调试并设置断点")]),t._v(" "),_("h4",{attrs:{id:"获取body"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#获取body"}},[t._v("#")]),t._v(" 获取body")]),t._v(" "),_("p",[t._v("koa不支持解析请求体，需要引入中间件"),_("strong",[t._v("koa-bodyparser")])]),t._v(" "),_("p",[_("code",[t._v("npm i koa-bodyparser --save")])]),t._v(" "),_("h3",{attrs:{id:"_5-3-发送-http-响应"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-发送-http-响应"}},[t._v("#")]),t._v(" 5-3 发送 HTTP 响应")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("发送 status")]),t._v(" "),_("li",[t._v("发送 body")]),t._v(" "),_("li",[t._v("发送 header")]),t._v(" "),_("li",[t._v("实现用户的增删改查")])])]),t._v(" "),_("h4",{attrs:{id:"发送-status-body"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#发送-status-body"}},[t._v("#")]),t._v(" 发送 status & body")]),t._v(" "),_("p",[_("code",[t._v("ctx.status = 204;")])]),t._v(" "),_("p",[_("code",[t._v("ctx.body = '<h1>这是主页</h1>';")])]),t._v(" "),_("h4",{attrs:{id:"发送-header"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#发送-header"}},[t._v("#")]),t._v(" 发送 header")]),t._v(" "),_("h4",{attrs:{id:"实现用户的增删改查"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#实现用户的增删改查"}},[t._v("#")]),t._v(" 实现用户的增删改查")]),t._v(" "),_("h3",{attrs:{id:"_5-4-更合理的目录结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-更合理的目录结构"}},[t._v("#")]),t._v(" 5-4 更合理的目录结构")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("将路由单独放在一个目录")]),t._v(" "),_("li",[t._v("将控制器单独放在一个目录")]),t._v(" "),_("li",[t._v("使用 类+类方法 的方式组织控制器")])])]),t._v(" "),_("p",[t._v("新建总文件夹"),_("code",[t._v("/app")]),t._v("，并修改入口文件")]),t._v(" "),_("div",{staticClass:"language-json package.json line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-json"}},[_("code",[_("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token property"}},[t._v('"start"')]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodemon app"')]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br"),_("span",{staticClass:"line-number"},[t._v("2")]),_("br"),_("span",{staticClass:"line-number"},[t._v("3")]),_("br")])]),_("ul",[_("li",[t._v("/app\n"),_("ul",[_("li",[t._v("/routes\n"),_("ul",[_("li",[t._v("home.js")]),t._v(" "),_("li",[t._v("users.js")])])]),t._v(" "),_("li",[t._v("/controllers\n"),_("ul",[_("li",[t._v("home.js")]),t._v(" "),_("li",[t._v("users.js")])])])])])]),t._v(" "),_("h2",{attrs:{id:"第6章-多种方案实现错误处理机制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第6章-多种方案实现错误处理机制"}},[t._v("#")]),t._v(" 第6章 多种方案实现错误处理机制")]),t._v(" "),_("blockquote",[_("p",[t._v("本章主要讲解多种方案的错误处理。主要分三方面，一是 Koa 框架自带的错误处理，一是编写错误处理中间件，一是使用优秀的错误处理中间件。")])]),t._v(" "),_("h3",{attrs:{id:"_6-1-错误处理简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-错误处理简介"}},[t._v("#")]),t._v(" 6-1 错误处理简介")]),t._v(" "),_("ul",[_("li",[t._v("什么是错误处理？\n"),_("ul",[_("li",[t._v("编程语言或计算机硬件里的一种机制")]),t._v(" "),_("li",[t._v("处理软件或信息系统中出现的异常状况")])])]),t._v(" "),_("li",[t._v("异常状况有哪些？\n"),_("ul",[_("li",[t._v("运行时错误，都返回500")]),t._v(" "),_("li",[t._v("逻辑错误，如找不到（404）、先决条件失败（412）、无法处理的实体（参数格式不对，422）等")])])]),t._v(" "),_("li",[t._v("为什么要用错误处理？\n"),_("ul",[_("li",[t._v("防止程序挂掉")]),t._v(" "),_("li",[t._v("告诉用户错误信息")]),t._v(" "),_("li",[t._v("便于开发者调试")])])])]),t._v(" "),_("h3",{attrs:{id:"_6-2-koa-自带的错误处理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-koa-自带的错误处理"}},[t._v("#")]),t._v(" 6-2 Koa 自带的错误处理")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("制造404、412、500三种错误")]),t._v(" "),_("li",[t._v("了解Koa自带的错误处理做了什么")])])]),t._v(" "),_("h3",{attrs:{id:"_6-3-自己编写错误处理中间件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-自己编写错误处理中间件"}},[t._v("#")]),t._v(" 6-3 自己编写错误处理中间件")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("自己编写错误处理中间件")]),t._v(" "),_("li",[t._v("制造404、412、500三种错误来测试")])])]),t._v(" "),_("h3",{attrs:{id:"_6-4-使用-koa-json-error-进行错误处理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-使用-koa-json-error-进行错误处理"}},[t._v("#")]),t._v(" 6-4 使用 koa-json-error 进行错误处理")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("安装koa-json-error")]),t._v(" "),_("li",[t._v("使用koa-json-error的默认配置处理错误")]),t._v(" "),_("li",[t._v("修改配置使其在生产环境下禁用错误堆栈的返回")])])]),t._v(" "),_("p",[_("code",[t._v("npm i koa-json-error --save")])]),t._v(" "),_("h3",{attrs:{id:"_6-5-使用-koa-parameter-校验参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-使用-koa-parameter-校验参数"}},[t._v("#")]),t._v(" 6-5 使用 koa-parameter 校验参数")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("安装koa一parameter")]),t._v(" "),_("li",[t._v("使用koa一parameter校验参数")]),t._v(" "),_("li",[t._v("制造422错误来测试校验结果")])])]),t._v(" "),_("p",[_("code",[t._v("npm i koa-parameter --save")])]),t._v(" "),_("h2",{attrs:{id:"第7章-第一批用户入库啦"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第7章-第一批用户入库啦"}},[t._v("#")]),t._v(" 第7章 第一批用户入库啦~~")]),t._v(" "),_("blockquote",[_("p",[t._v("本章主要讲解 NoSQL 概念以及 MongoDB 数据库的理论与入门实践。通过 MongoDB Atlas 云数据库学习 MongoDB 的增删改查等常见操作。")])]),t._v(" "),_("h3",{attrs:{id:"_7-1-nosql-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-nosql-简介"}},[t._v("#")]),t._v(" 7-1 NoSQL 简介")]),t._v(" "),_("ul",[_("li",[t._v("什么是NoSQL\n"),_("ul",[_("li",[t._v("对不同于传统的关系型数据库的数据库管理系统的统称")])])]),t._v(" "),_("li",[t._v("NoSQL数据库的分类\n"),_("ul",[_("li",[t._v("列存储（HBase）")]),t._v(" "),_("li",[t._v("文档存储（MongoDB）")]),t._v(" "),_("li",[t._v("Key-value存储（Redis）")]),t._v(" "),_("li",[t._v("图存储（FlockDB）")]),t._v(" "),_("li",[t._v("对象存储（db4o）")]),t._v(" "),_("li",[t._v("XML存储（BaseX）")])])]),t._v(" "),_("li",[t._v("为什么要用NoSQL\n"),_("ul",[_("li",[t._v("简单（没有原子性、一致性、隔离性等复杂规范）")]),t._v(" "),_("li",[t._v("便于横向拓展")]),t._v(" "),_("li",[t._v("适合超大规模数据的存储")]),t._v(" "),_("li",[t._v("很灵活地存储复杂结构的数据（Schema Free）")])])])]),t._v(" "),_("h3",{attrs:{id:"_7-2-mongodb-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-mongodb-简介"}},[t._v("#")]),t._v(" 7-2 MongoDB 简介")]),t._v(" "),_("ul",[_("li",[t._v("什么是MongoDB ？\n"),_("ul",[_("li",[t._v('来自于英文单词"Humongous”， 中文含义为"庞大”')]),t._v(" "),_("li",[t._v("面向文档存储的开源数据库")]),t._v(" "),_("li",[t._v("由C++编写而成")])])]),t._v(" "),_("li",[t._v("为什么要用MongoDB ？\n"),_("ul",[_("li",[t._v("性能好（内存计算）")]),t._v(" "),_("li",[t._v("大规模数据存储（可拓展性）")]),t._v(" "),_("li",[t._v("可靠安全（本地复制、自动故障转移）")]),t._v(" "),_("li",[t._v("方便存储复杂数据结构（Schema Free）")])])])]),t._v(" "),_("h3",{attrs:{id:"_7-3-云数据库-mongodb-atlas"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-云数据库-mongodb-atlas"}},[t._v("#")]),t._v(" 7-3 云数据库——MongoDB Atlas")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("注册用户")]),t._v(" "),_("li",[t._v("创建集群")]),t._v(" "),_("li",[t._v("添加数据库用户")]),t._v(" "),_("li",[t._v("设置IP地址白名单")]),t._v(" "),_("li",[t._v("获取连接地址")])])]),t._v(" "),_("p",[t._v("如果连接mongodb过程中出现以下错误，可以尝试设置付款方式/检查用户名&数据库名是否正确更改/等等再试")]),t._v(" "),_("div",{staticClass:"language-shell line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[t._v("Error: querySrv ESERVFAIL _mongodb._tcp.vincentebase.yqjup.mongodb.net\n    at QueryReqWrap.onresolve "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("as oncomplete"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dns.js:203:19"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  errno: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ESERVFAIL'")]),t._v(",\n  code: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ESERVFAIL'")]),t._v(",\n  syscall: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'querySrv'")]),t._v(",\n  hostname: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_mongodb._tcp.vincentebase.yqjup.mongodb.net'")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nError: queryTxt ESERVFAIL vincentebase.yqjup.mongodb.net\n    at QueryReqWrap.onresolve "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("as oncomplete"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dns.js:203:19"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  errno: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ESERVFAIL'")]),t._v(",\n  code: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ESERVFAIL'")]),t._v(",\n  syscall: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'queryTxt'")]),t._v(",\n  hostname: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vincentebase.yqjup.mongodb.net'")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br"),_("span",{staticClass:"line-number"},[t._v("2")]),_("br"),_("span",{staticClass:"line-number"},[t._v("3")]),_("br"),_("span",{staticClass:"line-number"},[t._v("4")]),_("br"),_("span",{staticClass:"line-number"},[t._v("5")]),_("br"),_("span",{staticClass:"line-number"},[t._v("6")]),_("br"),_("span",{staticClass:"line-number"},[t._v("7")]),_("br"),_("span",{staticClass:"line-number"},[t._v("8")]),_("br"),_("span",{staticClass:"line-number"},[t._v("9")]),_("br"),_("span",{staticClass:"line-number"},[t._v("10")]),_("br"),_("span",{staticClass:"line-number"},[t._v("11")]),_("br"),_("span",{staticClass:"line-number"},[t._v("12")]),_("br"),_("span",{staticClass:"line-number"},[t._v("13")]),_("br"),_("span",{staticClass:"line-number"},[t._v("14")]),_("br"),_("span",{staticClass:"line-number"},[t._v("15")]),_("br")])]),_("p",[_("a",{attrs:{href:"https://stackoverflow.com/questions/50362647/connecting-to-mongodb-atlas-from-firebase-functions/58822693#58822693?newreg=a3af857c5c944c34a5f48ff365b97c0e",target:"_blank",rel:"noopener noreferrer"}},[t._v("stackoverflow"),_("OutboundLink")],1),t._v("上的回答")]),t._v(" "),_("h3",{attrs:{id:"_7-4-使用-mongoose-连接-mongodb"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-使用-mongoose-连接-mongodb"}},[t._v("#")]),t._v(" 7-4 使用 Mongoose 连接 MongoDB")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("安装 Mong oose")]),t._v(" "),_("li",[t._v("用 Mongoose 连接 MongoDB")])])]),t._v(" "),_("p",[_("code",[t._v("npm i mongoose --save")])]),t._v(" "),_("h3",{attrs:{id:"_7-5-设计用户模块的-schema"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-设计用户模块的-schema"}},[t._v("#")]),t._v(" 7-5 设计用户模块的 Schema")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("分析用户模块的属性")]),t._v(" "),_("li",[t._v("编写用户模块的Schema")]),t._v(" "),_("li",[t._v("使用Schema生成用户Model")])])]),t._v(" "),_("h3",{attrs:{id:"_7-6-用-mongodb-实现用户的增删改查"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-用-mongodb-实现用户的增删改查"}},[t._v("#")]),t._v(" 7-6 用 MongoDB 实现用户的增删改查")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("用Mongoose实现增删改查接口")]),t._v(" "),_("li",[t._v("用Postman测试增删改查接口")])])]),t._v(" "),_("h2",{attrs:{id:"第8章-jwt-在-koa-框架中实现用户的认证与授权"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#第8章-jwt-在-koa-框架中实现用户的认证与授权"}},[t._v("#")]),t._v(" 第8章 JWT 在 Koa 框架中实现用户的认证与授权")]),t._v(" "),_("blockquote",[_("p",[t._v("本章主要讲解 JWT 如何实现用户的认证与授权。从 Session 开始讲解过渡到 JWT，关键在于 Session 和 JWT 的对比。以及通过 Koa 框架的 JWT 中间件实现用户注册于授权登录功能。")])]),t._v(" "),_("h3",{attrs:{id:"_8-1-session-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-session-简介"}},[t._v("#")]),t._v(" 8-1 Session 简介")]),t._v(" "),_("ul",[_("li",[t._v("Session的优势\n"),_("ul",[_("li",[t._v("相比JWT，最大的优势就在于可以主动清除session了")]),t._v(" "),_("li",[t._v("session保存在服务器端，相对较为安全")]),t._v(" "),_("li",[t._v("结合cookie使用，较为灵活，兼容性较好")])])]),t._v(" "),_("li",[t._v("Session的劣势\n"),_("ul",[_("li",[t._v("cookie + session在跨域场景表现并不好")]),t._v(" "),_("li",[t._v("如果是分布式部署，需要做多机共享session机制")]),t._v(" "),_("li",[t._v("基于cookie的机制很容易被CSRF")]),t._v(" "),_("li",[t._v("查询session信息可能会有数据库查询操作")])])]),t._v(" "),_("li",[t._v("Session相关的概念介绍\n"),_("ul",[_("li",[t._v("session: 主要存放在服务器端，相对安全")]),t._v(" "),_("li",[t._v("cookie: 主要存放在客户端，并且不是很安全")]),t._v(" "),_("li",[t._v("sessionStorage: 仅在当前会话下有效，关闭页面或浏览器后被清除")]),t._v(" "),_("li",[t._v("localstorage: 除非被清除，否则永久保存")])])])]),t._v(" "),_("h3",{attrs:{id:"_8-2-jwt-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-jwt-简介"}},[t._v("#")]),t._v(" 8-2 JWT 简介")]),t._v(" "),_("h4",{attrs:{id:"什么是jwt"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#什么是jwt"}},[t._v("#")]),t._v(" 什么是JWT")]),t._v(" "),_("ul",[_("li",[t._v("JSON Web Token是一个开放标准（RFC 7519）")]),t._v(" "),_("li",[t._v("定义了一种紧凑且独立的方式，可以将各方之间的信息作为JSON对象进行安全传输")]),t._v(" "),_("li",[t._v("该信息可以验证和信任，因为是经过数字签名的")])]),t._v(" "),_("h4",{attrs:{id:"jwt的构成"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jwt的构成"}},[t._v("#")]),t._v(" JWT的构成")]),t._v(" "),_("ul",[_("li",[t._v("头部（Header）\n"),_("ul",[_("li",[t._v("typ: token的类型， 这里固定为JWT")]),t._v(" "),_("li",[t._v("alg: 使用的hash算法，例如：HMACSHA256或者RSA")]),t._v(" "),_("li",[t._v('编码前: {"alg":"HS256","typ":"JWT"}')]),t._v(" "),_("li",[t._v("Base64编码: 'eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9'")])])]),t._v(" "),_("li",[t._v("有效载荷（Payload）\n"),_("ul",[_("li",[t._v("存储需要传递的信息，如用户ID、用户名等")]),t._v(" "),_("li",[t._v("还包含元数据，如过期时间、发布人等")]),t._v(" "),_("li",[t._v("与Header不同，Payload可以加密")]),t._v(" "),_("li",[t._v('编码前: {"user_id":"zhangsan"}')]),t._v(" "),_("li",[t._v("Base64编码: 'eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQ=='")]),t._v(" "),_("li",[t._v("Base64Url编码: 'eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQ'")])])]),t._v(" "),_("li",[t._v("签名（Signature）\n"),_("ul",[_("li",[t._v("对Header和Payload部分进行签名")]),t._v(" "),_("li",[t._v("保证Token在传输的过程中没有被篡改或者损坏")]),t._v(" "),_("li",[t._v('Signature = HMACSHA256(base64UrlEncode(header)+"."+base64UrlEncode(payload), secret)')])])])]),t._v(" "),_("h4",{attrs:{id:"jwt工作原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jwt工作原理"}},[t._v("#")]),t._v(" JWT工作原理")]),t._v(" "),_("image",{attrs:{src:"https://blog-1251959181.cos.ap-beijing.myqcloud.com/posts/354/JWT.png"}}),t._v(" "),_("h3",{attrs:{id:"_8-3-jwt-vs-session"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-jwt-vs-session"}},[t._v("#")]),t._v(" 8-3 JWT vs. Session")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",{staticStyle:{"text-align":"center"}}),t._v(" "),_("th",{staticStyle:{"text-align":"center"}},[t._v("JWT")]),t._v(" "),_("th",{staticStyle:{"text-align":"center"}},[t._v("Session")])])]),t._v(" "),_("tbody",[_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("可拓展性")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("无缝水平拓展")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("适合垂直拓展")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("安全性")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("JS可修改JWT，签名+加密")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("RESTful API")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("无状态")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("有状态")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("性能")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("传输信息多，请求开销大")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("需要查找用户信息，服务器开销大")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"center"}},[t._v("时效性")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("只有到期才可销毁")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[t._v("可以在服务器端更新")])])])]),t._v(" "),_("h3",{attrs:{id:"_8-4-在-node-js-中使用-jwt"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-在-node-js-中使用-jwt"}},[t._v("#")]),t._v(" 8-4 在 Node.js 中使用 JWT")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("安装 jsonwebtoken")]),t._v(" "),_("li",[t._v("签名")]),t._v(" "),_("li",[t._v("验证")])])]),t._v(" "),_("p",[_("code",[t._v("npm i jsonwebtoken")])]),t._v(" "),_("div",{staticClass:"language-shell line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[t._v("node\n"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jwt "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonwebtoken'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" token "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jwt.sign"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name: "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vincente'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secret'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jwt.decode"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jwt.verify"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token, "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secret'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br"),_("span",{staticClass:"line-number"},[t._v("2")]),_("br"),_("span",{staticClass:"line-number"},[t._v("3")]),_("br"),_("span",{staticClass:"line-number"},[t._v("4")]),_("br"),_("span",{staticClass:"line-number"},[t._v("5")]),_("br")])]),_("h3",{attrs:{id:"_8-5-实现用户注册"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-实现用户注册"}},[t._v("#")]),t._v(" 8-5 实现用户注册")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("设计用户Schema")]),t._v(" "),_("li",[t._v("编写保证唯一性的逻辑")])])]),t._v(" "),_("h3",{attrs:{id:"_8-6-实现登录并获取-token"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-实现登录并获取-token"}},[t._v("#")]),t._v(" 8-6 实现登录并获取 Token")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("登录接口设计")]),t._v(" "),_("li",[t._v("用jsonwebtoken生成token")])])]),t._v(" "),_("h3",{attrs:{id:"_8-7-自己编写-koa-中间件实现用户认证与授权"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-自己编写-koa-中间件实现用户认证与授权"}},[t._v("#")]),t._v(" 8-7 自己编写 Koa 中间件实现用户认证与授权")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("认证：验证token ，并获取用户信息")]),t._v(" "),_("li",[t._v("授权：使用中间件保护接口")])])]),t._v(" "),_("h3",{attrs:{id:"_8-8-用-koa-jwt-中间件实现用户认证与授权"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-用-koa-jwt-中间件实现用户认证与授权"}},[t._v("#")]),t._v(" 8-8 用 koa-jwt 中间件实现用户认证与授权")]),t._v(" "),_("blockquote",[_("p",[t._v("操作步骤")]),t._v(" "),_("ul",[_("li",[t._v("安装 koa-jwt")]),t._v(" "),_("li",[t._v("使用中间件保护接口")]),t._v(" "),_("li",[t._v("使用中间件获取用户信息")])])]),t._v(" "),_("p",[_("code",[t._v("npm i koa-jwt --save")])])])}),[],!1,null,null,null);a.default=v.exports}}]);